
@{
    ViewBag.Title = "Staff Account Management";
    Layout = "~/Views/Admin/_AdminLayout.cshtml";
}
<style>
    table {
        width: 100%;
        border-collapse: collapse;
    }

        table thead {
            background-color: #034b0093;
        }

            table thead tr {
            }

                table thead tr th {
                    font-size: 14px;
                    letter-spacing: 0.35px;
                    padding: 5px;
                    text-align: start;
                }

        table tbody tr td {
            font-size: 14px;
            letter-spacing: 0.35px;
            background-color: #809d813f;
            padding: 8px;
            text-align: start;
            transition: all 0.15s ease-in-out;
        }

        table tbody tr:hover td {
            color: black;
            background-color: #ffffff3f;
        }

    .ban {
        background-color: #ff0000cf;
    }

    .unban {
        background-color: #0ab00493;
    }
</style>
<h1>User Account Management (Staffs)</h1>
<div class="container">
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>Banned?</th>
                    <th>Email Address</th>
                    <th>Username</th>
                    <th>Role</th>
                    <th>Creation Date</th>
                    <th>Action(s)</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Count > 0)
                {
                    foreach (var user in Model)
                    {
                        if (user.email != User.Identity.Name && user.usertype != "Normal")
                        {
                            <tr>
                                <td data-label="is Banned?">@((@user.isbanned == 1) ? "YES" : (@user.isbanned == 0) ? "NO" : "Unknown")</td>
                                <td data-label="Email Address">@user.email</td>
                                <td data-label="Username">@user.username</td>
                                <td data-label="Role">@user.usertype</td>
                                <td data-label="Created At">@user.datecreated.ToString("MMMM d, yyyy")</td>
                                <td data-label="Action(s)">
                                    @if (user.isbanned == 0)
                                    {
                                        <button class="ban" id="btn" data-userid="@user.id" onclick="banUser(this)">
                                            <p id="tooltiptext">Ban</p>
                                            <i style="display: flex; justify-content: center; align-items: center; font-weight: 900" class='bx bx-block'></i>
                                        </button>
                                    }
                                    else
                                    {
                                        <button class="unban" id="btn" data-userid="@user.id" onclick="unbanUser(this)">
                                            <p id="tooltiptext">Unban</p>
                                            <i style="display: flex; justify-content: center; align-items: center; font-weight: 900" class='bx bx-reset'></i>
                                        </button>
                                    }
                                </td>
                            </tr>
                        }
                    }
                }
                else
                {
                    <tr><td colspan="6" style="text-align: center; padding-left: unset;">No Staff Account(s) found.</td></tr>
                }
            </tbody>
        </table>
    </div>
</div>
<script>
    window.addEventListener('load', function () {
        const dashboardLink = document.getElementById('staff');
        if (dashboardLink) {
            dashboardLink.classList.add('active');
        }

        const allLinks = document.querySelectorAll('.link');
        allLinks.forEach(link => {
            if (link !== dashboardLink) {
                link.classList.remove('active');
            }
        });
    });
</script>
<script>
    function banUser(button) {
        var userId = button.dataset.userid;

        // Display a confirmation dialog
        var confirmation = confirm("Are you sure you want to ban this user?");

        if (confirmation) {
            // Proceed with the ban operation
            $.ajax({
                url: '@Url.Action("Ban", "Admin")',
                type: 'POST',
                data: { id: userId },
                success: function (data) {
                    if (data.success) {
                        alert("User has been banned.");
                        location.reload();
                    } else {
                        alert("Error banning user."); // Handle error message from controller (optional)
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.error("Error:", textStatus, errorThrown); // Log errors to console
                    alert("An error occurred. Please try again later."); // User-friendly error message
                }
            });
        } else {
            // Do nothing or handle cancellation
            alert("Ban operation cancelled.");
        }
    }

    function unbanUser(button) {
    var userId = button.dataset.userid;

    // Display a confirmation dialog
    var confirmation = confirm("Are you sure you want to unban this user?");

    if (confirmation) {
        // Proceed with the unban operation
        $.ajax({
            url: '@Url.Action("Unban", "Admin")',
            type: 'POST',
            data: { id: userId },
            success: function (data) {
                if (data.success) {
                    alert("User has been unbanned.");
                    location.reload();
                } else {
                    alert("Error unbanning user."); // Handle error message from controller (optional)
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.error("Error:", textStatus, errorThrown); // Log errors to console
                alert("An error occurred. Please try again later."); // User-friendly error message
            }
        });
    } else {
        // Do nothing or handle cancellation
        alert("Unban operation cancelled.");
    }
}
</script>